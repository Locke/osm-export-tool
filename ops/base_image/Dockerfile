FROM ubuntu:16.04
LABEL maintainer "Seth Fitzsimmons <seth@mojodna.net>"

ENV DEBIAN_FRONTEND noninteractive

RUN \
  apt update \
  && apt upgrade -y \
  && apt install -y --no-install-recommends \
    apt-transport-https \
    curl \
    software-properties-common \
  && curl -sf https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \
  && add-apt-repository -y -u "deb https://deb.nodesource.com/node_6.x $(lsb_release -c -s) main" \
  && add-apt-repository -y -u ppa:ubuntugis/ubuntugis-unstable \
  && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \
  && add-apt-repository -y -u "deb https://dl.yarnpkg.com/debian/ stable main" \
  && apt install -y --no-install-recommends \
    build-essential \
    default-jre-headless \
    gdal-bin \
    git \
    language-pack-en-base \
    libffi-dev \
    libgdal-dev \
    libmagic1 \
    libpq-dev \
    libqt5core5a \
    libsqlite3-mod-spatialite \
    libspatialite7 \
    libspatialite-dev \
    libproxy1v5 \
    libxslt1-dev \
    nodejs \
    osmctools \
    postgresql-client \
    python-dev \
    python-pip \
    python-setuptools \
    python-wheel \
    python-gdal \
    spatialite-bin \
    unzip \
    yarn \
    zip \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

ENV LC_ALL en_US.UTF-8

RUN \
  curl -sfL http://download.osmand.net/latest-night-build/OsmAndMapCreator-main.zip -o /tmp/osmandmapcreator.zip \
    && unzip /tmp/osmandmapcreator.zip -d /opt/osmandmapcreator \
    && rm /tmp/osmandmapcreator.zip

RUN \
  curl -sfL https://s3.amazonaws.com/bdon/brandon.liu.hotosm.org/mkgmap-r3890.zip -o /tmp/mkgmap.zip \
    && unzip /tmp/mkgmap.zip -d /opt \
    && mv /opt/mkgmap-* /opt/mkgmap \
    && rm /tmp/mkgmap.zip

RUN \
  curl -sfL https://s3.amazonaws.com/bdon/brandon.liu.hotosm.org/splitter-r583.zip -o /tmp/splitter.zip \
    && unzip /tmp/splitter.zip -d /opt \
    && mv /opt/splitter-* /opt/splitter \
    && rm /tmp/splitter.zip

ENV OSMCONVERT /usr/bin/osmconvert
